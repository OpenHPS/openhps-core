!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@openhps/core")):"function"==typeof define&&define.amd?define("OpenHPS",["core"],t):"object"==typeof exports?exports.OpenHPS=t(require("@openhps/core")):(e.OpenHPS=e.OpenHPS||{},e.OpenHPS.geospatial=t(e.OpenHPS.core))}("undefined"!=typeof self?self:this,(function(e){return(()=>{"use strict";var t={504:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.Building=void 0;const n=o(0),i=o(677);let c=class Building extends i.SymbolicSpace{setBounds(e){if(Array.isArray(e))super.setBounds(e);else if("width"in e){const t=new n.Euler(0,0,e.rotation,"XYZ",n.AngleUnit.DEGREE);this.rotation(t);const o=e.topLeft.destination(e.rotation,e.width),r=o.destination(e.rotation+90,e.height),i=e.topLeft.destination(e.rotation+90,e.height);super.setBounds([i,e.topLeft,o,r])}else super.setBounds(e);return this}getLocalBounds(){const e=[new n.Absolute2DPosition(0,0)];for(let t=1;t<this.getBounds().length;t++){const o=this.getBounds()[t-1],r=this.getBounds()[t],i=o.distanceTo(r),c=o.angleTo(r)-this.rotationQuaternion.toEuler().z,s=e[t-1],a=new n.Vector2(s.x,s.y);e.push((new n.Absolute2DPosition).fromVector(a.add(new n.Vector2(i,0).rotateAround(new n.Vector2(0,0),-c))))}return e}transform(e,t){const o=this.getBounds()[0],r=this.rotationQuaternion.toEuler().yaw;if(e instanceof n.GeographicalPosition){const t=o.distanceTo(e),i=r-o.bearing(e),c=this.getLocalBounds()[0].clone(),s=new n.Vector2(c.x,c.y);return s.add(new n.Vector2(t).rotateAround(new n.Vector2(0,0),n.AngleUnit.DEGREE.convert(i,n.AngleUnit.RADIAN))),c.fromVector(s),c}if(e instanceof n.Absolute2DPosition)return o.destination(r,e.x).destination(r-90,e.y)}};c=r([(0,n.SerializableObject)()],c),t.Building=c},905:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.Corridor=void 0;const n=o(0),i=o(469);let c=class Corridor extends i.Zone{};c=r([(0,n.SerializableObject)()],c),t.Corridor=c},642:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.Elevator=void 0;const n=o(0),i=o(622);let c=class Elevator extends i.VerticalPassage{};c=r([(0,n.SerializableObject)()],c),t.Elevator=c},279:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Floor=void 0;const i=o(0),c=o(677);let s=class Floor extends c.SymbolicSpace{setBuilding(e){return this.parent=e,this.setBounds(e.getLocalBounds()),this.priority=e.priority+1,this}setFloorNumber(e,t=3){return this.translation(0,0,e*t),this}setHeight(e){return this.height=e,this}};r([(0,i.SerializableMember)(),n("design:type",Number)],s.prototype,"height",void 0),s=r([(0,i.SerializableObject)()],s),t.Floor=s},721:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GeospatialAccuracy=void 0;const i=o(0);let c=class GeospatialAccuracy extends i.Accuracy{constructor(e){super(e,i.LengthUnit.METER)}toString(){return this.value.displayName}valueOf(){return this.value.getBounds().map((e=>this.value.centroid.distanceTo(e))).reduce(((e,t)=>Math.max(e,t)),0)}};c=r([(0,i.SerializableObject)(),n("design:paramtypes",[Object])],c),t.GeospatialAccuracy=c},829:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;const n=o(0),i=o(469);let c=class Room extends i.Zone{};c=r([(0,n.SerializableObject)()],c),t.Room=c},677:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolicSpace=void 0;const i=o(0);let c=class SymbolicSpace extends i.ReferenceSpace{constructor(e){super(),this.coordinates=[],this.connectedSpaces=new Map,this.priority=0,this.displayName=e}setBounds(e){return Array.isArray(e)?this._setArrayBounds(e):"topLeft"in e&&this._setRectangleBounds(e),this._update(),this}_setRectangleBounds(e){if("width"in e){const t=new i.Euler(0,0,e.rotation,"XYZ",i.AngleUnit.DEGREE);this.rotation(t);const o=e.topLeft.toVector3(i.LengthUnit.METER);o.add(new i.Vector3(e.width,0,0).applyEuler(t));const r=e.topLeft.toVector3(i.LengthUnit.METER);r.add(new i.Vector3(0,e.height,0).applyEuler(t));const n=e.topLeft.toVector3(i.LengthUnit.METER);n.add(new i.Vector3(e.width,e.height,0).applyEuler(t)),this._setArrayBounds([e.topLeft.clone().fromVector(r,i.LengthUnit.METER),e.topLeft,e.topLeft.clone().fromVector(o,i.LengthUnit.METER),e.topLeft.clone().fromVector(n,i.LengthUnit.METER)])}else this._setArrayBounds([e.topLeft,e.bottomRight])}_setArrayBounds(e){this.positionConstructor=e[0].constructor;const t=e.map((e=>e.toVector3(i.LengthUnit.METER)));if(2===e.length){const e=t[0],o=t[1],r=o.clone().sub(e);0!==t.map((e=>e.z)).reduce(((e,t)=>e+t))?(this.coordinates.push(e),this.coordinates.push(e.clone().add(new i.Vector3(r.x,0,0))),this.coordinates.push(e.clone().add(new i.Vector3(0,r.y,0))),this.coordinates.push(e.clone().add(new i.Vector3(r.x,r.y,0))),this.coordinates.push(e.clone().add(new i.Vector3(r.x,0,r.z))),this.coordinates.push(e.clone().add(new i.Vector3(0,r.y,r.z))),this.coordinates.push(e.clone().add(new i.Vector3(0,0,r.z))),this.coordinates.push(o)):(this.coordinates.push(e.clone().add(new i.Vector3(0,r.y,0))),this.coordinates.push(e),this.coordinates.push(e.clone().add(new i.Vector3(r.x,0,0))),this.coordinates.push(o))}else this.coordinates=t}getBounds(){return this.coordinates.map((e=>{const t=new this.positionConstructor;return t.fromVector(e,i.LengthUnit.METER),t}))}_update(){this.centroid=new this.positionConstructor,this.centroid.referenceSpaceUID=this.uid;const e=this.coordinates.reduce(((e,t)=>e.clone().add(t))).divideScalar(this.coordinates.length);this.centroid.fromVector(e)}set parent(e){super.parent=e}isInside(e){const t=e.toVector3();let o=!1;for(let e=0,r=this.coordinates.length-1;e<this.coordinates.length;r=e++){const n=this.coordinates[e].x,i=this.coordinates[e].y,c=this.coordinates[e].z,s=this.coordinates[r].x,a=this.coordinates[r].y,l=this.coordinates[r].z;i>t.y!=a>t.y&&c>=t.z!=l>t.z&&t.x<(s-n)*(t.y-i)/(a-i)+n&&(o=!o)}return o}isConnected(e){return Array.from(this.connectedSpaces.values()).includes(e.uid)}addConnectedSpace(e,t){return this.connectedSpaces.set(t.toVector3(),e.uid),this}toPosition(){return this.centroid}toGeoJSON(){return{type:"Feature",geometry:{type:"Polygon",coordinates:[this.getBounds().map((e=>this.transform(e).toVector3().toArray()))]},properties:{name:this.displayName,uid:this.uid,parent_uid:this.parentUID,priority:this.priority,type:this.constructor.name}}}};r([(0,i.SerializableArrayMember)(i.Vector3),n("design:type",Array)],c.prototype,"coordinates",void 0),r([(0,i.SerializableMember)({serializer:e=>e.name,deserializer:e=>i.DataSerializer.findTypeByName(e)}),n("design:type",Function)],c.prototype,"positionConstructor",void 0),r([(0,i.SerializableMember)(),n("design:type",i.AbsolutePosition)],c.prototype,"centroid",void 0),r([(0,i.SerializableMapMember)(i.Vector3,String),n("design:type",Map)],c.prototype,"connectedSpaces",void 0),r([(0,i.SerializableMember)({constructor:Number}),n("design:type",Object)],c.prototype,"priority",void 0),c=r([(0,i.SerializableObject)(),n("design:paramtypes",[String])],c),t.SymbolicSpace=c},622:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalPassage=void 0;const n=o(0),i=o(677);let c=class VerticalPassage extends i.SymbolicSpace{};c=r([(0,n.SerializableObject)()],c),t.VerticalPassage=c},469:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(c=(i<3?n(c):i>3?n(t,o,c):n(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c};Object.defineProperty(t,"__esModule",{value:!0}),t.Zone=void 0;const n=o(0),i=o(677);let c=class Zone extends i.SymbolicSpace{setFloor(e){return this.parent=e,this.priority=e.priority+1,this}};c=r([(0,n.SerializableObject)()],c),t.Zone=c},13:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(677),t),n(o(829),t),n(o(504),t),n(o(279),t),n(o(905),t),n(o(469),t),n(o(622),t),n(o(642),t),n(o(721),t)},915:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(13),t),n(o(501),t)},572:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SymbolicSpaceService=void 0;const r=o(0);class SymbolicSpaceService extends r.DataObjectService{constructor(e){super(e)}findSymbolicSpaces(e){return new Promise(((t,o)=>{this.findAll().then((o=>{t(o.filter((t=>t.isInside(e))).sort(((e,t)=>t.priority-e.priority)).map((e=>[e,e.priority])))})).catch(o)}))}}t.SymbolicSpaceService=SymbolicSpaceService},501:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),n=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),n(o(572),t)},0:t=>{t.exports=e}},o={};var r=function e(r){var n=o[r];if(void 0!==n)return n.exports;var i=o[r]={exports:{}};return t[r].call(i.exports,i,i.exports,e),i.exports}(915);return r})()}));
//# sourceMappingURL=openhps-geospatial.min.js.map